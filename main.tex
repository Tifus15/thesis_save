%% This is file `DEMO-TUDaThesis.tex' version 3.32 (2023/06/19),
%% it is part of
%% TUDa-CI -- Corporate Design for TU Darmstadt
%% ----------------------------------------------------------------------------
%%
%%  Copyright (C) 2018--2023 by Marei Peischl <marei@peitex.de>
%%
%% ============================================================================
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3c
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%% http://www.latex-project.org/lppl.txt
%% and version 1.3c or later is part of all distributions of LaTeX
%% version 2008/05/04 or later.
%%
%% This work has the LPPL maintenance status `maintained'.
%%
%% The Current Maintainers of this work are
%%   Marei Peischl <tuda-ci@peitex.de>
%%   Markus Lazanowski <latex@ce.tu-darmstadt.de>
%%
%% The development respository can be found at
%% https://github.com/tudace/tuda_latex_templates
%% Please use the issue tracker for feedback!
%%
%% If you need a compiled version of this document, have a look at
%% http://mirror.ctan.org/macros/latex/contrib/tuda-ci/doc
%% or at the documentation directory of this package (if installed)
%% <path to your LaTeX distribution>/doc/latex/tuda-ci
%% ============================================================================
%%
% !TeX program = lualatex
%%

\documentclass[
	ngerman,
	ruledheaders=section,%Ebene bis zu der die Überschriften mit Linien abgetrennt werden, vgl. DEMO-TUDaPub
	class=report,% Basisdokumentenklasse. Wählt die Korrespondierende KOMA-Script Klasse
	thesis={type=master},% Dokumententyp Thesis, für Dissertationen siehe die Demo-Datei DEMO-TUDaPhd
	accentcolor=9c,% Auswahl der Akzentfarbe
	custommargins=true,% Ränder werden mithilfe von typearea automatisch berechnet
	marginpar=false,% Kopfzeile und Fußzeile erstrecken sich nicht über die Randnotizspalte
	%BCOR=5mm,%Bindekorrektur, falls notwendig
	parskip=half-,%Absatzkennzeichnung durch Abstand vgl. KOMA-Script
	fontsize=11pt,%Basisschriftgröße laut Corporate Design ist mit 9pt häufig zu klein
	%	logofile=example-image, %Falls die Logo Dateien nicht vorliegen
]{tudapub}


% Der folgende Block ist nur bei pdfTeX auf Versionen vor April 2018 notwendig
\usepackage{iftex}
\ifPDFTeX
	\usepackage[utf8]{inputenc}%kompatibilität mit TeX Versionen vor April 2018
\fi

%%%%%%%%%%%%%%%%%%%
%Sprachanpassung & Verbesserte Trennregeln
%%%%%%%%%%%%%%%%%%%
\usepackage[ngerman, main=english]{babel}
\usepackage[autostyle]{csquotes}% Anführungszeichen vereinfacht

% Falls mit pdflatex kompiliert wird, wird microtype automatisch geladen, in diesem Fall muss diese Zeile entfernt werden, und falls weiter Optionen hinzugefügt werden sollen, muss dies über
% \PassOptionsToPackage{Optionen}{microtype}
% vor \documentclass hinzugefügt werden.
\usepackage{microtype}

%%%%%%%%%%%%%%%%%%%
%Literaturverzeichnis
%%%%%%%%%%%%%%%%%%%
\usepackage{biblatex}   % Literaturverzeichnis
%\bibliography{DEMO-TUDaBibliography.bib}
\addbibresource{biblio.bib}
\setcounter{tocdepth}{4}
\setcounter{secnumdepth}{4}


%%%%%%%%%%%%%%%%%%%
%Paketvorschläge Tabellen
%%%%%%%%%%%%%%%%%%%
%\usepackage{array}     % Basispaket für Tabellenkonfiguration, wird von den folgenden automatisch geladen
\usepackage{tabularx}   % Tabellen, die sich automatisch der Breite anpassen
%\usepackage{longtable} % Mehrseitige Tabellen
%\usepackage{xltabular} % Mehrseitige Tabellen mit anpassbarer Breite
\usepackage{booktabs}   % Verbesserte Möglichkeiten für Tabellenlayout über horizontale Linien
\usepackage{float}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{subcaption}

%%%%%%%%%%%%%%%%%%%
%Paketvorschläge Mathematik
%%%%%%%%%%%%%%%%%%%
%\usepackage{mathtools} % erweiterte Fassung von amsmath
%\usepackage{amssymb}   % erweiterter Zeichensatz
%\usepackage{siunitx}   % Einheiten

%Formatierungen für Beispiele in diesem Dokument. Im Allgemeinen nicht notwendig!
\let\file\texttt
\let\code\texttt
\let\tbs\textbackslash
\let\pck\textsf
\let\cls\textsf
\usepackage{comment}
\usepackage{pifont}% Zapf-Dingbats Symbole
\usepackage{listings}
\usepackage{xcolor} % For color support
\newcommand*{\FeatureTrue}{\ding{52}}
\newcommand*{\FeatureFalse}{\ding{56}}


\lstset{
	language=Python,                % Specify the programming language
	basicstyle=\ttfamily\footnotesize,  % Font style and size
	keywordstyle=\color{blue},      % Keywords color
	commentstyle=\color{gray},      % Comment color
	stringstyle=\color{orange},     % String color
	numberstyle=\tiny\color{gray},  % Line numbers color and size
	stepnumber=1,                   % Line numbers step
	numbersep=10pt,                 % Distance between line numbers and code
	backgroundcolor=\color{lightgray!20},  % Background color of code
	frame=single,                   % Frame around code
	breaklines=true,                % Line break if the code is too long
	captionpos=b,                   % Caption position
}





\begin{document}

\Metadata{
	title=Thesis,
	author=Denis Andrić
}

\title{Implementation of Neural Models for Accurate Prediction of Robot Trajectories in Hamiltonian Spaces: A Graph Neural Network Approach}
\subtitle{Implementierung von neuronalen Modellen zur präzisen Vorhersage von Trajektorien in Hamiltonschen Räumen: 
	Ein Ansatz mit Graph-Neuronalen Netzwerken}
\author[D. Andrić]{Denis Andrić}
\studentID{2486004}%optionales Argument ist die Signatur,
\birthplace{Darmstadt}%Geburtsort, bei Dissertationen zwingend notwendig
\reviewer{Georgia Chalvatzaki \and An Thai Le}%Gutachter

%Diese Felder werden untereinander auf der Titelseite platziert.
%\department ist eine notwendige Angabe, siehe auch dem Abschnitt `Abweichung von den Vorgaben für die Titelseite'
%\department{ce} % Das Kürzel wird automatisch ersetzt und als Studienfach gewählt, siehe Liste der Kürzel im Dokument.
%\institute{FB 20}
\addTitleBoxLogo*{\includegraphics[width=0.5\linewidth]{logos/CELogo.png}}
\addTitleBoxLogo*{\includegraphics[width=0.5\linewidth]{logos/pearllogo.png}}
\addTitleBoxLogo*{\includegraphics[width=0.5\linewidth]{logos/iasLogo.png}}
\submissiondate{\today}
\examdate{\today}

% Hinweis zur Lizenz:
% TUDa-CI verwendet momentan die Lizenz CC BY-NC-ND 2.0 DE als Voreinstellung.
% Die TU Darmstadt hat jedoch die Empfehlung von dieser auf die liberalere
% CC BY 4.0 geändert. Diese erlaubt eine Verwendung bearbeiteter Versionen und
% die kommerzielle Nutzung.
% TUDa-CI wird im nächsten größeren Release ebenfalls diese Anpassung vornehmen.
% Aus diesem Grund wird empfohlen die Lizenz manuell auszuwählen.
%\tuprints{urn=XXXXX,printid=XXXX,year=2022,license=cc-by-4.0}
% To see further information on the license option in English, remove the license= key and pay attention to the warning & help message.

% \dedication{Für alle, die \TeX{} nutzen.}

\maketitle

\affidavit
% Es gibt mit Version 3.20 die Möglichkeit ein Bild als Signatur einzubinden.
% TUDa-CI kann nicht garantieren, dass dies zulässig ist oder eine eigenhändige Unterschrift ersetzt.
% Dies ist durch Studierende vor der Verwendung abzuklären.
% Die Verwendung funktioniert so:
%\affidavit[signature-image={\includegraphics[width=\width,height=1cm]{example-image}}, <hier können andere Optionen zusätzlich stehen>]

\tableofcontents
\listoffigures
\listoftables+

\include{chapters/abstract}

\include{chapters/chapter1/introduction}
\include{chapters/chapter2/background}
\include{chapters/chapter3/datasets}
\include{chapters/chapter4/methods}
\include{chapters/chapter5/experiments}
\include{chapters/chapter6/conclusions}


\begin{lstlisting}[language=Python, caption={Sample Python code}]
"""
class which creates matrix vector multiplication for trajectory rollout
k: stiffness coeficient
m: mass
"""
class oscigradH(nn.Module):
	def __init__(self,k,m):
		super(oscigradH,self).__init__()
		self.A=torch.zeros(2,2).to(device_util.DEVICE)
		self.A[0,1]=1/m
		self.A[1,0]=-k
	
	def forward(self,t,y):
		return torch.matmul(y,self.A.T)
"""
class to create an oscilator data
k: stiffness coeficient
m: mass

"""    
class oscilator:
	def __init__(self,m,k):
		self.k = k
		self.m = m
		self.F = oscigradH(k,m).to(device_util.DEVICE)
"""
method for period T
"""
	def getT(self):
		return 2*math.pi/math.sqrt(self.k/self.m)


"""
method for creating randomly initial values for the oscilator
samples : number of initial values
H_span : region for the energy
"""	
	def make_inits(self,samples,H_span=[1,5]):
		Hs = H_span[0]*torch.rand(samples,)*(H_span[1]-H_span[0])
		a = torch.sqrt(2*self.m*Hs)
		b = torch.sqrt(2*Hs/self.k)
		phis = torch.rand(samples,)*2*torch.pi

		p = a * torch.cos(phis)
		p = torch.unsqueeze(p,dim=-1)

		x = b * torch.sin(phis)
		x = torch.unsqueeze(x,dim=-1)

		return torch.cat((x,p),dim=-1)
"""
method for calculating hamitlonian

returns: hamiltonian
"""
def hamiltonian(self,dataset):
# dataset type [len(t),batches,1,2], [len(t),1,2], [batches,1,2]
	if dataset.dim() > 3:
		dataset = dataset.squeeze()
	if dataset.dim() < 3:
		dataset = torch.unsqueeze(dataset,dim=1)
	x = dataset[:,:,0]
	p = dataset[:,:,1]

	T = p.square()/(2*self.m)
	U = self.k*x.square()/2

	H = T+U
	return H

"""
method for creating only one trajectory
points: number of time points, sequence length
H_span: region for the energy

returns: trajectory and time
"""
	def make_one(self,points, H_span=[1,5]):
		omega = math.sqrt(self.k/self.m)
		T = 2*math.pi/omega

		t = torch.linspace(0,T,points).to(device_util.DEVICE)
		y=self.make_inits(1,H_span=H_span).to(device_util.DEVICE)
		data = odeint(self.F,y[0,:],t,method="rk4")

		return data.unsqueeze(dim=1), t
"""
method for creating the dataset 
points: number of time points,sequence length
samples : number of initial values
T: period if 0, else end time
H_span: region for the energy

returns: trajectory and time
"""
def make_dataset(self,points,samples,T = 0,H_span=[1,5]):
	if T == 0:
		omega = math.sqrt(self.k/self.m)
	T = 2*math.pi/omega
	t = torch.linspace(0,T,points).to(device_util.DEVICE)
	y=self.make_inits(samples,H_span=H_span).to(device_util.DEVICE)
	y=torch.unsqueeze(y,dim=1)
	print(y.shape)
	data = odeint(self.F,y,t,method="rk4")

	return data, t
\end{lstlisting}




\printbibliography

\end{document}
